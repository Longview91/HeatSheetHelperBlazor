<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>HeatSheetHelperBlazor</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="HeatSheetHelperBlazor.styles.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
</head>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>

    <script>
        window.scrollToEventHeat = function (eventNumber, heatNumber) {
            var el = document.getElementById(`event-${eventNumber}-heat-${heatNumber}`);
            if (el) {
                var stickyOffset = document.querySelector('.event-selection-dropdown')?.offsetHeight || 0;
                stickyOffset += document.querySelector('.nav-menu')?.offsetHeight || 0; // Add nav menu height if present
                var elementPosition = el.getBoundingClientRect().top + window.pageYOffset;
                var offsetPosition = elementPosition - stickyOffset - 20; // Add a small margin (10px)

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        }
    </script>

    <script>
        let lastScrollTop = 0;
        let ticking = false;

        window.registerNavMenuScroll = function (dotNetHelper) {
            window.addEventListener('scroll', function () {
                if (!ticking) {
                    window.requestAnimationFrame(function () {
                        let st = window.pageYOffset || document.documentElement.scrollTop;
                        if (st > lastScrollTop + 10) {
                            console.log("Scrolling down"); // Add this line
                            // Scrolling down
                            dotNetHelper.invokeMethodAsync('HideNavMenu');
                        } else if (st < lastScrollTop - 10) {
                            console.log("Scrolling up"); // Add this line
                            // Scrolling up
                            dotNetHelper.invokeMethodAsync('ShowNavMenu');
                        }
                        lastScrollTop = st <= 0 ? 0 : st;
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        }
    </script>

    <script>
        function adjustDropdownPosition() {
            const navMenu = document.querySelector('.nav-menu');
            const dropdown = document.querySelector('.event-selection-dropdown');
            if (navMenu && dropdown) {
                const navHeight = navMenu.offsetHeight;
                dropdown.style.top = `${navHeight}px`;
            }
        }

        // Adjust on page load and window resize
        window.addEventListener('load', adjustDropdownPosition);
        window.addEventListener('resize', adjustDropdownPosition);
        window.addEventListener('contextmenu', adjustDropdownPosition);
    </script>

    <script>
        window.getScrollY = function () {
            // Always return a number
            var y = window.scrollY || window.pageYOffset || document.documentElement.scrollTop || 0;
            return Number.isFinite(y) ? y : 0;
        };
    </script>

    <script>
        window.getStoredScrollY = function (key) {
            var val = localStorage.getItem(key);
            var num = Number(val);
            return isNaN(num) ? 0 : num;
        };
    </script>

    <script>
        window.saveScrollPosition = function () {
            sessionStorage.setItem('scrollY', window.scrollY);
        };
        window.restoreScrollPosition = function () {
            const y = sessionStorage.getItem('scrollY');
            if (y !== null) window.scrollTo(0, parseInt(y));
        };
        window.addEventListener('beforeunload', window.saveScrollPosition);
        window.addEventListener('unload', window.saveScrollPosition);
        window.addEventListener('DOMContentLoaded', window.restoreScrollPosition);
    </script>

    <script>
        window.allEventsState = {
            save: function (state) {
                localStorage.setItem('allEventsState', JSON.stringify(state));
            },
            load: function () {
                const state = localStorage.getItem('allEventsState');
                return state ? JSON.parse(state) : null;
            }
        };
    </script>

    <script>
        window.blazorLocalStorage = {
            get: function (key) {
                return Promise.resolve(localStorage.getItem(key));
            },
            set: function (key, value) {
                localStorage.setItem(key, value);
                return Promise.resolve();
            }
        };
    </script>

    <script>
        window.setTableHeaderColor = function (color) {
            document.documentElement.style.setProperty('--table-header-color', color);
        };
    </script>

</body>

</html>